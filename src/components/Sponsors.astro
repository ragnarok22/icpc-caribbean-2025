---
import { getSponsors } from "@/lib/api";

// Fetch sponsors from API
const response = await getSponsors({ page_size: 100 });
const sponsors = response.error ? [] : response.data;
---

<section class="bg-red text-center" id="sponsors">
  <div class="mx-auto max-w-6xl px-4 py-16 sm:px-6">
    <h2 class="text-3xl text-white sm:text-4xl">Nuestros Patrocinadores</h2>
    <p class="mx-auto mt-4 max-w-2xl text-sm text-gray-50 sm:text-base">
      Gracias a nuestros patrocinadores por hacer posible este evento
    </p>

    <div class="mt-12 flex flex-wrap items-center justify-center gap-8">
      {
        sponsors.length > 0 ? (
          sponsors.map((sponsor) => {
            // Check if image URL is valid (not example.com or invalid)
            const isValidUrl =
              sponsor.image_url &&
              !sponsor.image_url.includes("example.com") &&
              sponsor.image_url.startsWith("http");

            // Create fallback placeholder
            const placeholderSvg = `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 200 200'%3E%3Crect width='200' height='200' fill='%23f9fafb'/%3E%3Ccircle cx='100' cy='80' r='30' fill='%23e5e7eb'/%3E%3Crect x='60' y='130' width='80' height='8' rx='4' fill='%23e5e7eb'/%3E%3Crect x='70' y='145' width='60' height='6' rx='3' fill='%23f3f4f6'/%3E%3Ctext x='100' y='180' font-size='10' font-family='Arial' text-anchor='middle' fill='%239ca3af'%3E${encodeURIComponent(sponsor.name)}%3C/text%3E%3C/svg%3E`;

            const imageUrl = isValidUrl ? sponsor.image_url : placeholderSvg;

            return (
              <div
                class="group hover:border-blue flex h-32 w-32 items-center justify-center rounded-lg border border-gray-200 bg-white p-6 transition-all duration-300 hover:shadow-lg"
                title={`${sponsor.name} - ${sponsor.category} - $${sponsor.amount_donated}`}
              >
                <img
                  src={imageUrl}
                  alt={`Logo de ${sponsor.name}`}
                  class="max-h-full max-w-full object-contain transition-transform duration-300 group-hover:scale-110"
                  loading="lazy"
                  onerror={`this.onerror=null; this.src='${placeholderSvg}';`}
                />
              </div>
            );
          })
        ) : (
          <p class="text-gray-100">No hay patrocinadores disponibles</p>
        )
      }
    </div>
  </div>
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320" class="-mb-1">
    <path
      fill="var(--color-blue)"
      fill-opacity="1"
      d="M0,96L48,85.3C96,75,192,53,288,48C384,43,480,53,576,85.3C672,117,768,171,864,208C960,245,1056,267,1152,240C1248,213,1344,139,1392,101.3L1440,64L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"
    ></path>
  </svg>
</section>
